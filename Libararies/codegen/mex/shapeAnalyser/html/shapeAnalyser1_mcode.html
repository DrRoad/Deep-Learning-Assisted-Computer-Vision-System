<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">availableShapes</span>, <span class="var type1" id="S3T2U4">edgedRegion</span>] = shapeAnalyser(<span class="var type1" id="S3T2U7">edgedRegion</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment"><span class="comment">%{</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">detectTriangle: Uses Hough Transform to detect the presence of triangles,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">octagons, diamonds, rectangles and square shapes in an image.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">STEPS</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">1. Get Image and convert to grayscale</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="comment">2. Perform edge detection on image</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">3. Create hough parameter space, a 2D array (?,?) with maximum ? length </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">   spanning the diagonal length of the image and maximum ? spaning 180. </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">4. Initialize hough parameter space to zero</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">5. Loop through entire image and for every active pixel on co-ordinate x,y,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">   calculate as many (?,?) values associated with it by varying ? between -90 and 89.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">6. For every pixel which has a line lying on (?,?), increment the value stored in (?,?) by 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">7. After looping through all the relevant pixels of the image and </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">   incrementing (?,?) appropriately in the hough parameter space, </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">   search through the hough parameter space for the peak values. </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">   The (?,?)  accomoating this peak values can be used to draw the detected lines.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">8. Find angles between detected lines. </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">        a.  If three or more lines have angles of 60 degrees with each </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">            other, then a triangle is most likely present</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">        b.  If eight or more lines that have angles 135 degrees exist, </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">            then an octagon is most likely present</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">        c.  If four or more lines exist that have angles 90 degrees,  </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">            then a square, rectangle or diamond is most likely present</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">   Created on: 1st July, 2017</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">   Author: Oluwole Oyetoke Jnr</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">   Using MATLAB 2016</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"><span class="comment"><span class="comment">%}</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%INPUT VALIDATION AND IMAGE TRANSFORMATION</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%if nargin ~= 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%    error('shapeAnalyser:Input_Argument_Error','This function works with 1 input argument -inputImg- ')</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%end </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo " id="T3:U4"><span class="var type1" id="S4T3U10">RESOLUTION</span> = <span class="mxinfo " id="T3:U6">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"><span class="mxinfo " id="T3:U7"><span class="var type1" id="S5T3U14">HOUGHTHRESHFACTOR</span> = <span class="mxinfo " id="T3:U9">0.7</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="mxinfo " id="T3:U10"><span class="var type1" id="S6T3U18">PIXELTHRESHFACTOR</span> = <span class="mxinfo " id="T3:U12">0.3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">%EDGE DETECTION</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">%[edgedRegion] = detectEdge(img);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"><span class="mxinfo " id="T3:U13">[<span class="var type1" id="S7T3U23">xDim</span>, <span class="var type1" id="S8T3U24">yDim</span>, <span class="var type1" id="S9T3U25">zDim</span>] = size(<span class="var type1" id="S3T2U28">edgedRegion</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line">[<span class="var type1" id="S11T3U32">maxPixVal</span> <span class="var type1" id="S12T3U33">index</span>] = max(<span class="mxinfo " id="T4:U20"><span class="var type1" id="S3T2U37">edgedRegion</span>(:)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%CREATE ACCUMULATOR AND VARIABLES</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"><span class="mxinfo " id="T3:U22"><span class="var type1" id="S14T3U41">tethaMin</span> = <span class="mxinfo " id="T3:U24">-90</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"><span class="mxinfo " id="T3:U25"><span class="var type1" id="S15T3U46">tethaMax</span>=<span class="mxinfo " id="T3:U27">90</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"><span class="mxinfo " id="T3:U28"><span class="var type1" id="S16T3U50">maxRadius</span> = <span class="mxinfo " id="T3:U30">ceil(<span class="mxinfo " id="T3:U31">sqrt(<span class="mxinfo " id="T3:U32">(<span class="mxinfo " id="T3:U33"><span class="var type1" id="S7T3U58">xDim</span>*<span class="var type1" id="S7T3U59">xDim</span></span>) + (<span class="mxinfo " id="T3:U36"><span class="var type1" id="S8T3U62">yDim</span>*<span class="var type1" id="S8T3U63">yDim</span></span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="mxinfo " id="T5:U39"><span class="var type1" id="S19T5U66">Tethas</span> = <span class="mxinfo " id="T5:U41"><span class="var type1" id="S14T3U69">tethaMin</span>:<span class="var type1" id="S4T3U70">RESOLUTION</span>:(<span class="var type1" id="S15T3U73">tethaMax</span>-<span class="var type1" id="S4T3U74">RESOLUTION</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"><span class="mxinfo " id="T6:U46"><span class="var type1" id="S20T6U77">Rhos</span> = <span class="mxinfo " id="T6:U48"><span class="mxinfo " id="T3:U49">-<span class="var type1" id="S16T3U81">maxRadius</span></span>:<span class="var type1" id="S4T3U82">RESOLUTION</span>:(<span class="mxinfo " id="T3:U52"><span class="var type1" id="S16T3U85">maxRadius</span>-<span class="var type1" id="S4T3U86">RESOLUTION</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="mxinfo " id="T3:U55"><span class="var type1" id="S21T3U89">rhoRange</span> = <span class="mxinfo " id="T3:U57">length(<span class="var type1" id="S20T6U92">Rhos</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"><span class="mxinfo " id="T3:U59"><span class="var type1" id="S23T3U95">tethaRange</span> = <span class="mxinfo " id="T3:U61">length(<span class="var type1" id="S19T5U98">Tethas</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"><span class="mxinfo " id="T7:U63"><span class="var type1" id="S24T7U101">parameterSpace</span> = <span class="mxinfo " id="T7:U65">zeros(<span class="var type1" id="S21T3U104">rhoRange</span>, <span class="var type1" id="S23T3U105">tethaRange</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">%Create sine and cos look up table</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line">[<span class="var type1" id="S26T5U109">sineTable</span> <span class="var type1" id="S27T5U110">cosTable</span>] = <span class="fcn" id="F125N4:B112">createSineCosLUT</span>(<span class="var type1" id="S19T5U113">Tethas</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%GET RHO AND THETAs</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S29T3U116">x</span> = <span class="mxinfo " id="T3:U72">1</span>:<span class="var type1" id="S7T3U119">xDim</span> <span class="comment">%Loop through x pixels</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S30T3U122">y</span> = <span class="mxinfo " id="T3:U75">1</span>:<span class="var type1" id="S8T3U125">yDim</span> <span class="comment">%Loop through y pixels</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T8:U77"><span class="mxinfo " id="T3:U78"><span class="var type1" id="S3T2U130">edgedRegion</span>(<span class="var type1" id="S29T3U131">x</span>,<span class="var type1" id="S30T3U132">y</span>)</span>&gt;=(<span class="mxinfo " id="T3:U82"><span class="var type1" id="S6T3U135">PIXELTHRESHFACTOR</span>*<span class="var type1" id="S11T3U136">maxPixVal</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S31T3U139">tetha</span> = <span class="mxinfo " id="T3:U86">1</span>:<span class="var type1" id="S23T3U142">tethaRange</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line">                <span class="comment">%x and y switch positions due to MATLAb x,y matrix/image co-ordinate system</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line">                <span class="mxinfo " id="T3:U88"><span class="var type1" id="S32T3U145">rho</span> = <span class="mxinfo " id="T3:U90">ceil(<span class="mxinfo " id="T3:U91">(<span class="mxinfo " id="T3:U92"><span class="var type1" id="S30T3U151">y</span>*<span class="mxinfo " id="T3:U94"><span class="var type1" id="S27T5U153">cosTable</span>(<span class="mxinfo " id="T3:U96">1</span>,<span class="var type1" id="S31T3U155">tetha</span>)</span></span>) + (<span class="mxinfo " id="T3:U98"><span class="var type1" id="S29T3U158">x</span>*<span class="mxinfo " id="T3:U100"><span class="var type1" id="S26T5U160">sineTable</span>(<span class="mxinfo " id="T3:U102">1</span>,<span class="var type1" id="S31T3U162">tetha</span>)</span></span>)</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo " id="T8:U104"><span class="var type1" id="S32T3U167">rho</span>&gt;=<span class="mxinfo " id="T3:U106">-<span class="var type1" id="S16T3U169">maxRadius</span></span></span> &amp;&amp; <span class="mxinfo " id="T8:U108"><span class="var type1" id="S32T3U171">rho</span>&lt;=(<span class="mxinfo " id="T3:U110"><span class="var type1" id="S16T3U174">maxRadius</span>-<span class="var type1" id="S4T3U175">RESOLUTION</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">                <span class="mxinfo " id="T3:U113"><span class="var type1" id="S33T3U178">rhoIndex</span> = <span class="mxinfo " id="T3:U115">round(<span class="mxinfo " id="T3:U116"><span class="mxinfo " id="T3:U117">(<span class="mxinfo " id="T3:U118"><span class="var type1" id="S21T3U185">rhoRange</span>/<span class="mxinfo " id="T3:U120">2</span></span>)+<span class="var type1" id="S32T3U187">rho</span></span>+<span class="var type1" id="S4T3U188">RESOLUTION</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">                <span class="mxinfo " id="T3:U123"><span class="mxinfo " id="T3:U124"><span class="var type1" id="S24T7U192">parameterSpace</span>(<span class="var type1" id="S33T3U193">rhoIndex</span>,<span class="var type1" id="S31T3U194">tetha</span>)</span> = <span class="mxinfo " id="T3:U128"><span class="mxinfo " id="T3:U129"><span class="var type1" id="S24T7U197">parameterSpace</span>(<span class="var type1" id="S33T3U198">rhoIndex</span>,<span class="var type1" id="S31T3U199">tetha</span>)</span>+<span class="mxinfo " id="T3:U133">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line"><span class="comment">%FIND PEAKS IN HOUGH SPACE AND PLOT</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line"><span class="comment">%Locate 10 most prominent peaks</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">%P = houghpeaks(parameterSpace,10,<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"> <span class="comment">%   'threshold',ceil(HOUGHTHRESHFACTOR*max(parameterSpace(:)))); </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"><span class="comment">%imshow(parameterSpace,[],'XData',Tethas,'YData',Rhos,'InitialMagnification','fit');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line"><span class="comment">%xlabel('\theta'), ylabel('\rho');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line"><span class="comment">%axis on, axis normal, hold on;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">%plot(Tethas(P(:,2)),Rhos(P(:,1)),'s','color','white');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">%title('Hough Matrix');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line"><span class="comment">%FIND DOMINANT LINES</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"><span class="mxinfo " id="T6:U134"><span class="var type1" id="S35T6U203">lineRhos</span>= <span class="mxinfo " id="T3:U136">zeros(1,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"><span class="mxinfo " id="T6:U137"><span class="var type1" id="S36T6U210">lineTethas</span> = <span class="mxinfo " id="T3:U139">zeros(1,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line">[<span class="var type1" id="S37T3U218">maxVal</span> <span class="var type1" id="S12T3U219">index</span>] = max(<span class="mxinfo " id="T4:U142"><span class="var type1" id="S24T7U223">parameterSpace</span>(:)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line">[<span class="var type1" id="S38T3U228">maxI</span> <span class="var type1" id="S39T3U229">maxJ</span>]=ind2sub(<span class="mxinfo " id="T9:U146">[<span class="var type1" id="S21T3U234">rhoRange</span> <span class="var type1" id="S23T3U235">tethaRange</span>]</span>,<span class="var type1" id="S12T3U236">index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"><span class="mxinfo " id="T3:U150"><span class="var type1" id="S41T3U239">THRESHOLD</span> = <span class="mxinfo " id="T3:U152">ceil(<span class="mxinfo " id="T3:U153"><span class="var type1" id="S5T3U243">HOUGHTHRESHFACTOR</span>*<span class="var type1" id="S37T3U244">maxVal</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line"><span class="mxinfo " id="T3:U156"><span class="var type1" id="S42T3U247">numDetected</span>=<span class="mxinfo " id="T3:U158">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T8:U159"><span class="var type1" id="S37T3U252">maxVal</span> &gt;=<span class="mxinfo " id="T3:U161">20</span></span> <span class="comment">%At least a line as long as 20 pixels has to be present</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line"><span class="mxinfo " id="T10:U162"><span class="var type1" id="S43T10U256">parameterSpaceMask</span> = (<span class="mxinfo " id="T10:U164"><span class="var type1" id="S24T7U259">parameterSpace</span>&gt;=<span class="var type1" id="S41T3U260">THRESHOLD</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line"><span class="mxinfo " id="T3:U167"><span class="var type1" id="S42T3U263">numDetected</span> = <span class="mxinfo " id="T3:U169">sum(<span class="mxinfo " id="T5:U170">sum(<span class="mxinfo " id="T10:U171"><span class="var type1" id="S24T7U269">parameterSpace</span>&gt;=<span class="var type1" id="S41T3U270">THRESHOLD</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">[<span class="var type1" id="S45T4U274">row</span>, <span class="var type1" id="S46T4U275">col</span>] = find(<span class="mxinfo " id="T10:U176"><span class="var type1" id="S43T10U279">parameterSpaceMask</span>==<span class="mxinfo " id="T3:U178">1</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line"><span class="mxinfo " id="T6:U179"><span class="var type1" id="S35T6U283">lineRhos</span> = <span class="mxinfo " id="T6:U181"><span class="var type1" id="S20T6U285">Rhos</span>(<span class="mxinfo " id="T3:U183">1</span>, <span class="var type1" id="S45T4U287">row</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line"><span class="mxinfo " id="T6:U185"><span class="var type1" id="S36T6U290">lineTethas</span> = <span class="mxinfo " id="T6:U187"><span class="var type1" id="S19T5U292">Tethas</span>(<span class="mxinfo " id="T3:U189">1</span>, <span class="var type1" id="S46T4U294">col</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line"><span class="keyword">end</span> <span class="comment">%End of if</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line"><span class="comment">%PLOT DISCOVERED LINES (MANUAL)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line"><span class="mxinfo " id="T3:U191"><span class="var type1" id="S48T3U297">xStart</span> = <span class="mxinfo " id="T3:U193">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line"><span class="mxinfo " id="T3:U194"><span class="var type1" id="S49T3U301">xEnd</span> = <span class="var type1" id="S8T3U302">yDim</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line"><span class="comment">%figure, imshow(uint8(inputImg)), hold on</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line"><span class="comment">%If more a line is detected</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T8:U197"><span class="var type1" id="S42T3U306">numDetected</span> &gt;=<span class="mxinfo " id="T3:U199">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line">    <span class="mxinfo " id="T6:U200"><span class="var type1" id="S50T6U310">xStartArray</span> = <span class="mxinfo " id="T6:U202">zeros(<span class="mxinfo " id="T3:U203">1</span>,<span class="var type1" id="S42T3U314">numDetected</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line">    <span class="mxinfo " id="T6:U205"><span class="var type1" id="S51T6U317">xEndArray</span> = <span class="mxinfo " id="T6:U207">zeros(<span class="mxinfo " id="T3:U208">1</span>,<span class="var type1" id="S42T3U321">numDetected</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line">    <span class="mxinfo " id="T6:U210"><span class="var type1" id="S52T6U324">yStartArray</span> = <span class="mxinfo " id="T6:U212">zeros(<span class="mxinfo " id="T3:U213">1</span>,<span class="var type1" id="S42T3U328">numDetected</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line">    <span class="mxinfo " id="T6:U215"><span class="var type1" id="S53T6U331">yEndArray</span> = <span class="mxinfo " id="T6:U217">zeros(<span class="mxinfo " id="T3:U218">1</span>,<span class="var type1" id="S42T3U335">numDetected</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S54T3U338">i</span>=<span class="mxinfo " id="T3:U221">1</span>:<span class="var type1" id="S42T3U341">numDetected</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line">        <span class="mxinfo " id="T3:U223"><span class="var type1" id="S55T3U344">r</span> = <span class="mxinfo " id="T3:U225"><span class="var type1" id="S35T6U346">lineRhos</span>(<span class="mxinfo " id="T11:U227">1</span>,<span class="var type1" id="S54T3U348">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line">        <span class="mxinfo " id="T3:U229"><span class="var type1" id="S56T3U351">angle</span> = <span class="mxinfo " id="T3:U231"><span class="var type1" id="S36T6U353">lineTethas</span>(<span class="mxinfo " id="T11:U233">1</span>,<span class="var type1" id="S54T3U355">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo " id="T8:U235"><span class="var type1" id="S56T3U360">angle</span> == <span class="mxinfo " id="T3:U237">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line">        <span class="mxinfo " id="T3:U238"><span class="mxinfo " id="T3:U239"><span class="var type1" id="S50T6U365">xStartArray</span>(<span class="mxinfo " id="T3:U241">1</span>,<span class="var type1" id="S54T3U367">i</span>)</span> = <span class="var type1" id="S55T3U368">r</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line">        <span class="mxinfo " id="T3:U244"><span class="mxinfo " id="T3:U245"><span class="var type1" id="S51T6U372">xEndArray</span>(<span class="mxinfo " id="T3:U247">1</span>,<span class="var type1" id="S54T3U374">i</span>)</span> = <span class="var type1" id="S55T3U375">r</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line">        <span class="mxinfo " id="T3:U250"><span class="mxinfo " id="T3:U251"><span class="var type1" id="S52T6U379">yStartArray</span>(<span class="mxinfo " id="T3:U253">1</span>,<span class="var type1" id="S54T3U381">i</span>)</span> = <span class="mxinfo " id="T3:U255">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line">        <span class="mxinfo " id="T3:U256"><span class="mxinfo " id="T3:U257"><span class="var type1" id="S53T6U386">yEndArray</span>(<span class="mxinfo " id="T3:U259">1</span>,<span class="var type1" id="S54T3U388">i</span>)</span> = <span class="var type1" id="S7T3U389">xDim</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line">        <span class="comment">%plot([r r], [1 xDim],'LineWidth',2, 'Color', 'green');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line">        <span class="comment">%Compute starting y coordinate</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line">        <span class="mxinfo " id="T3:U262"><span class="var type1" id="S57T3U393">yStart</span> = <span class="mxinfo " id="T3:U264">ceil(<span class="mxinfo " id="T3:U265">(<span class="mxinfo " id="T3:U266">(<span class="mxinfo " id="T3:U267"><span class="mxinfo " id="T3:U268">-<span class="mxinfo " id="T3:U269">cosd(<span class="var type1" id="S56T3U404">angle</span>)</span></span>/<span class="mxinfo " id="T3:U271">sind(<span class="var type1" id="S56T3U407">angle</span>)</span></span>)*<span class="var type1" id="S48T3U408">xStart</span></span>) + (<span class="mxinfo " id="T3:U274"><span class="var type1" id="S55T3U411">r</span> / <span class="mxinfo " id="T3:U276">sind(<span class="var type1" id="S56T3U414">angle</span>)</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line">        <span class="mxinfo " id="T3:U278"><span class="mxinfo " id="T3:U279"><span class="var type1" id="S52T6U418">yStartArray</span>(<span class="mxinfo " id="T3:U281">1</span>,<span class="var type1" id="S54T3U420">i</span>)</span> = <span class="var type1" id="S57T3U421">yStart</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line">        <span class="comment">%Compute ending y coordinate</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line">        <span class="mxinfo " id="T3:U284"><span class="var type1" id="S60T3U424">yEnd</span> = <span class="mxinfo " id="T3:U286">ceil(<span class="mxinfo " id="T3:U287">(<span class="mxinfo " id="T3:U288">(<span class="mxinfo " id="T3:U289"><span class="mxinfo " id="T3:U290">-<span class="mxinfo " id="T3:U291">cosd(<span class="var type1" id="S56T3U435">angle</span>)</span></span>/<span class="mxinfo " id="T3:U293">sind(<span class="var type1" id="S56T3U438">angle</span>)</span></span>)*<span class="var type1" id="S49T3U439">xEnd</span></span>) + (<span class="mxinfo " id="T3:U296"><span class="var type1" id="S55T3U442">r</span> / <span class="mxinfo " id="T3:U298">sind(<span class="var type1" id="S56T3U445">angle</span>)</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line">        <span class="mxinfo " id="T3:U300"><span class="mxinfo " id="T3:U301"><span class="var type1" id="S53T6U449">yEndArray</span>(<span class="mxinfo " id="T3:U303">1</span>,<span class="var type1" id="S54T3U451">i</span>)</span> = <span class="var type1" id="S60T3U452">yEnd</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line">        <span class="mxinfo " id="T3:U306"><span class="mxinfo " id="T3:U307"><span class="var type1" id="S50T6U456">xStartArray</span>(<span class="mxinfo " id="T3:U309">1</span>,<span class="var type1" id="S54T3U458">i</span>)</span> = <span class="mxinfo " id="T3:U311">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line">        <span class="mxinfo " id="T3:U312"><span class="mxinfo " id="T3:U313"><span class="var type1" id="S51T6U463">xEndArray</span>(<span class="mxinfo " id="T3:U315">1</span>,<span class="var type1" id="S54T3U465">i</span>)</span> = <span class="var type1" id="S8T3U466">yDim</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line">        <span class="comment">%plot([xStart xEnd], [yStart yEnd], 'LineWidth',2,'Color','blue');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line">        <span class="comment">%drawnow</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line">    <span class="keyword">end</span> <span class="comment">% end of for loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line">    <span class="comment">%Not necessary, but c coder needed it</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line">    <span class="mxinfo " id="T6:U318"><span class="var type1" id="S50T6U470">xStartArray</span> = <span class="mxinfo " id="T3:U320">zeros(1,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">    <span class="mxinfo " id="T6:U321"><span class="var type1" id="S51T6U477">xEndArray</span> = <span class="mxinfo " id="T3:U323">zeros(1,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line">    <span class="mxinfo " id="T6:U324"><span class="var type1" id="S52T6U484">yStartArray</span> = <span class="mxinfo " id="T3:U326">zeros(1,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line">    <span class="mxinfo " id="T6:U327"><span class="var type1" id="S53T6U491">yEndArray</span> = <span class="mxinfo " id="T3:U329">zeros(1,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line"><span class="keyword">end</span> <span class="comment">%end of if statement</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line"><span class="comment">%FIND ANGLE BETWEEN LINES</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line"><span class="comment">% The angle between two lines is the angle between their direction vectors. </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line"><span class="comment">% The direction vectors of two lines can always be found by subtracting the </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line"><span class="comment">% position vectors of two points on the line</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line"><span class="mxinfo " id="T3:U330"><span class="var type1" id="S48T3U498">xStart</span> = <span class="mxinfo " id="T3:U332">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line"><span class="mxinfo " id="T3:U333"><span class="var type1" id="S49T3U502">xEnd</span> = <span class="var type1" id="S8T3U503">yDim</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line"><span class="mxinfo " id="T6:U336"><span class="var type1" id="S61T6U506">anglesDetected</span>= <span class="mxinfo " id="T6:U338">zeros(<span class="mxinfo " id="T3:U339">1</span>,<span class="mxinfo " id="T3:U340">(<span class="mxinfo " id="T3:U341"><span class="var type1" id="S42T3U513">numDetected</span>*<span class="var type1" id="S42T3U514">numDetected</span></span>)-<span class="var type1" id="S42T3U515">numDetected</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line"><span class="mxinfo " id="T3:U345"><span class="var type1" id="S62T3U518">x1</span> = <span class="var type1" id="S48T3U519">xStart</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line"><span class="mxinfo " id="T3:U348"><span class="var type1" id="S63T3U522">x2</span> = <span class="var type1" id="S49T3U523">xEnd</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line"><span class="mxinfo " id="T3:U351"><span class="var type1" id="S64T3U526">x3</span> = <span class="var type1" id="S48T3U527">xStart</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line"><span class="mxinfo " id="T3:U354"><span class="var type1" id="S65T3U530">x4</span> = <span class="var type1" id="S49T3U531">xEnd</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line"><span class="mxinfo " id="T3:U357"><span class="var type1" id="S66T3U534">y1</span>=<span class="mxinfo " id="T3:U359">0</span></span>;<span class="mxinfo " id="T3:U360"><span class="var type1" id="S67T3U538">y2</span>=<span class="mxinfo " id="T3:U362">0</span></span>;<span class="mxinfo " id="T3:U363"><span class="var type1" id="S68T3U542">y3</span>=<span class="mxinfo " id="T3:U365">0</span></span>;<span class="mxinfo " id="T3:U366"><span class="var type1" id="S69T3U546">y4</span>=<span class="mxinfo " id="T3:U368">0</span></span>;<span class="mxinfo " id="T3:U369"><span class="var type1" id="S70T3U550">ang</span>=<span class="mxinfo " id="T3:U371">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line"><span class="mxinfo " id="T3:U372"><span class="var type1" id="S71T3U554">noOfAngles</span>=<span class="mxinfo " id="T3:U374">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T8:U375"><span class="var type1" id="S42T3U559">numDetected</span>&gt;<span class="mxinfo " id="T3:U377">2</span></span> <span class="comment">%If more than two line is detected</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line"> <span class="keyword">for</span> <span class="var type1" id="S54T3U563">i</span>=<span class="mxinfo " id="T3:U379">1</span>:<span class="var type1" id="S42T3U566">numDetected</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line">     </span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line">     <span class="mxinfo " id="T3:U381"><span class="var type1" id="S66T3U569">y1</span> =  <span class="mxinfo " id="T3:U383"><span class="var type1" id="S52T6U571">yStartArray</span>(<span class="mxinfo " id="T3:U385">1</span>,<span class="var type1" id="S54T3U573">i</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line">     <span class="mxinfo " id="T3:U387"><span class="var type1" id="S67T3U576">y2</span> = <span class="mxinfo " id="T3:U389"><span class="var type1" id="S53T6U578">yEndArray</span>(<span class="mxinfo " id="T11:U391">1</span>,<span class="var type1" id="S54T3U580">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line">     <span class="mxinfo " id="T3:U393"><span class="var type1" id="S62T3U583">x1</span> = <span class="mxinfo " id="T3:U395"><span class="var type1" id="S50T6U585">xStartArray</span>(<span class="mxinfo " id="T3:U397">1</span>,<span class="var type1" id="S54T3U587">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line">     <span class="mxinfo " id="T3:U399"><span class="var type1" id="S63T3U590">x2</span> = <span class="mxinfo " id="T3:U401"><span class="var type1" id="S51T6U592">xEndArray</span>(<span class="mxinfo " id="T11:U403">1</span>,<span class="var type1" id="S54T3U594">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line">     <span class="keyword">for</span> <span class="var type1" id="S72T3U597">j</span>=<span class="mxinfo " id="T3:U406">1</span>:<span class="var type1" id="S42T3U600">numDetected</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line">          <span class="keyword">if</span> <span class="mxinfo " id="T8:U408"><span class="var type1" id="S72T3U604">j</span>&lt;=<span class="var type1" id="S54T3U605">i</span></span> <span class="comment">%itself</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line">              <span class="keyword">continue</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line">          <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line">          <span class="mxinfo " id="T3:U411"><span class="var type1" id="S68T3U609">y3</span> =<span class="mxinfo " id="T3:U413"><span class="var type1" id="S52T6U611">yStartArray</span>(<span class="mxinfo " id="T3:U415">1</span>,<span class="var type1" id="S72T3U613">j</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line">          <span class="mxinfo " id="T3:U417"><span class="var type1" id="S69T3U616">y4</span> = <span class="mxinfo " id="T3:U419"><span class="var type1" id="S53T6U618">yEndArray</span>(<span class="mxinfo " id="T11:U421">1</span>,<span class="var type1" id="S72T3U620">j</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line">          <span class="mxinfo " id="T3:U423"><span class="var type1" id="S64T3U623">x3</span> =<span class="mxinfo " id="T3:U425"><span class="var type1" id="S50T6U625">xStartArray</span>(<span class="mxinfo " id="T3:U427">1</span>,<span class="var type1" id="S72T3U627">j</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line">          <span class="mxinfo " id="T3:U429"><span class="var type1" id="S65T3U630">x4</span> = <span class="mxinfo " id="T3:U431"><span class="var type1" id="S51T6U632">xEndArray</span>(<span class="mxinfo " id="T11:U433">1</span>,<span class="var type1" id="S72T3U634">j</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line">          <span class="mxinfo " id="T3:U435"><span class="var type1" id="S70T3U637">ang</span> = <span class="mxinfo " id="T3:U437">abs(<span class="mxinfo " id="T3:U438"><span class="mxinfo " id="T3:U439">atand(<span class="mxinfo " id="T3:U440">(<span class="mxinfo " id="T3:U441"><span class="var type1" id="S67T3U646">y2</span>-<span class="var type1" id="S66T3U647">y1</span></span>)/(<span class="mxinfo " id="T3:U444"><span class="var type1" id="S63T3U650">x2</span>-<span class="var type1" id="S62T3U651">x1</span></span>)</span>)</span>-<span class="mxinfo " id="T3:U447">atand(<span class="mxinfo " id="T3:U448">(<span class="mxinfo " id="T3:U449"><span class="var type1" id="S69T3U657">y4</span>-<span class="var type1" id="S68T3U658">y3</span></span>)/(<span class="mxinfo " id="T3:U452"><span class="var type1" id="S65T3U661">x4</span>-<span class="var type1" id="S64T3U662">x3</span></span>)</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line">          <span class="keyword">if</span> <span class="mxinfo " id="T8:U455"><span class="var type1" id="S54T3U666">i</span>==<span class="mxinfo " id="T3:U457">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line">           <span class="mxinfo " id="T3:U458"><span class="mxinfo " id="T3:U459"><span class="var type1" id="S61T6U671">anglesDetected</span>(<span class="mxinfo " id="T3:U461">1</span>,<span class="mxinfo " id="T3:U462">1</span>)</span> =  <span class="var type1" id="S70T3U674">ang</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line">           <span class="mxinfo " id="T3:U464"><span class="var type1" id="S71T3U677">noOfAngles</span>=<span class="mxinfo " id="T3:U466"><span class="var type1" id="S71T3U679">noOfAngles</span>+<span class="mxinfo " id="T3:U468">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line">         <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line">             <span class="mxinfo " id="T3:U469"><span class="mxinfo " id="T3:U470"><span class="var type1" id="S61T6U685">anglesDetected</span>(<span class="mxinfo " id="T3:U472">1</span>,<span class="var type1" id="S71T3U687">noOfAngles</span>)</span> =  <span class="var type1" id="S70T3U688">ang</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line">             <span class="mxinfo " id="T3:U475"><span class="var type1" id="S71T3U691">noOfAngles</span>=<span class="mxinfo " id="T3:U477"><span class="var type1" id="S71T3U693">noOfAngles</span>+<span class="mxinfo " id="T3:U479">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line">         <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line">     <span class="keyword">end</span> <span class="comment">%end of inner for loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line"> <span class="keyword">end</span> <span class="comment">%end of for loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line"><span class="keyword">end</span> <span class="comment">%end of if numDetected</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,213" id="srcline213">213</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,214" id="srcline214">214</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,215" id="srcline215">215</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,216" id="srcline216">216</a></span><span class="line"><span class="comment">%MAKE SHAPE DECSION</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,217" id="srcline217">217</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,218" id="srcline218">218</a></span><span class="line"><span class="comment">%if angles are detected</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,219" id="srcline219">219</a></span><span class="line"><span class="comment">%noOfAngles = length(anglesDetected);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,220" id="srcline220">220</a></span><span class="line"><span class="mxinfo " id="T3:U480"><span class="var type1" id="S75T3U697">sixtyCounter</span>=<span class="mxinfo " id="T3:U482">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,221" id="srcline221">221</a></span><span class="line"><span class="mxinfo " id="T3:U483"><span class="var type1" id="S76T3U701">one35Counter</span>=<span class="mxinfo " id="T3:U485">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,222" id="srcline222">222</a></span><span class="line"><span class="mxinfo " id="T3:U486"><span class="var type1" id="S77T3U705">ninetyCounter</span>=<span class="mxinfo " id="T3:U488">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,223" id="srcline223">223</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T8:U489"><span class="var type1" id="S71T3U710">noOfAngles</span>&gt;=<span class="mxinfo " id="T3:U491">3</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,224" id="srcline224">224</a></span><span class="line"><span class="mxinfo " id="T3:U492"><span class="var type1" id="S78T3U714">detected</span>=<span class="mxinfo " id="T3:U494">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,225" id="srcline225">225</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S79T3U718">pos</span> = <span class="mxinfo " id="T3:U496">1</span>:<span class="var type1" id="S71T3U721">noOfAngles</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,226" id="srcline226">226</a></span><span class="line">    <span class="mxinfo " id="T3:U498"><span class="var type1" id="S78T3U724">detected</span> = <span class="mxinfo " id="T3:U500"><span class="var type1" id="S61T6U726">anglesDetected</span>(<span class="mxinfo " id="T11:U502">1</span>,<span class="var type1" id="S79T3U728">pos</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,227" id="srcline227">227</a></span><span class="line">    <span class="comment">%If 3 or more lines have angles of 60 degrees then a triangle is present</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,228" id="srcline228">228</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T8:U504"><span class="var type1" id="S78T3U733">detected</span>&gt;=<span class="mxinfo " id="T3:U506">59</span></span> &amp;&amp; <span class="mxinfo " id="T8:U507"><span class="var type1" id="S78T3U736">detected</span>&lt;=<span class="mxinfo " id="T3:U509">61</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,229" id="srcline229">229</a></span><span class="line">        <span class="mxinfo " id="T3:U510"><span class="var type1" id="S75T3U740">sixtyCounter</span> = <span class="mxinfo " id="T3:U512"><span class="var type1" id="S75T3U742">sixtyCounter</span>+<span class="mxinfo " id="T3:U514">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,230" id="srcline230">230</a></span><span class="line"><span class="comment">%If 8 or more lines that have angles 135 degrees exist, then octagon is</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,231" id="srcline231">231</a></span><span class="line"><span class="comment">%present</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,232" id="srcline232">232</a></span><span class="line">    <span class="keyword">elseif</span> <span class="mxinfo " id="T8:U515"><span class="var type1" id="S78T3U747">detected</span>&gt;=<span class="mxinfo " id="T3:U517">134</span></span> &amp;&amp; <span class="mxinfo " id="T8:U518"><span class="var type1" id="S78T3U750">detected</span>&lt;=<span class="mxinfo " id="T3:U520">136</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,233" id="srcline233">233</a></span><span class="line">        <span class="mxinfo " id="T3:U521"><span class="var type1" id="S76T3U754">one35Counter</span> = <span class="mxinfo " id="T3:U523"><span class="var type1" id="S76T3U756">one35Counter</span>+<span class="mxinfo " id="T3:U525">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,234" id="srcline234">234</a></span><span class="line"><span class="comment">%If four or more lines exist that have angles 90 degrees, then square,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,235" id="srcline235">235</a></span><span class="line"><span class="comment">%rectangle or diamond exists</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,236" id="srcline236">236</a></span><span class="line">    <span class="keyword">elseif</span> <span class="mxinfo " id="T8:U526"><span class="var type1" id="S78T3U761">detected</span>&gt;=<span class="mxinfo " id="T3:U528">89</span></span> &amp;&amp; <span class="mxinfo " id="T8:U529"><span class="var type1" id="S78T3U764">detected</span>&lt;=<span class="mxinfo " id="T3:U531">91</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,237" id="srcline237">237</a></span><span class="line">        <span class="mxinfo " id="T3:U532"><span class="var type1" id="S77T3U768">ninetyCounter</span> = <span class="mxinfo " id="T3:U534"><span class="var type1" id="S77T3U770">ninetyCounter</span>+<span class="mxinfo " id="T3:U536">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,238" id="srcline238">238</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,239" id="srcline239">239</a></span><span class="line"><span class="keyword">end</span> <span class="comment">%End of for loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,240" id="srcline240">240</a></span><span class="line"><span class="keyword">end</span> <span class="comment">%end of if length(anglesDetected)&gt;=2</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,241" id="srcline241">241</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,242" id="srcline242">242</a></span><span class="line"><span class="mxinfo " id="T3:U537"><span class="var type1" id="S80T3U774">triangleAvailable</span> =<span class="mxinfo " id="T3:U539">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,243" id="srcline243">243</a></span><span class="line"><span class="mxinfo " id="T3:U540"><span class="var type1" id="S81T3U778">squareAvailable</span>   =<span class="mxinfo " id="T3:U542">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,244" id="srcline244">244</a></span><span class="line"><span class="mxinfo " id="T3:U543"><span class="var type1" id="S82T3U782">octagonAvailable</span>  =<span class="mxinfo " id="T3:U545">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,245" id="srcline245">245</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,246" id="srcline246">246</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T8:U546"><span class="var type1" id="S75T3U787">sixtyCounter</span>&gt;=<span class="mxinfo " id="T3:U548">3</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,247" id="srcline247">247</a></span><span class="line">    <span class="mxinfo " id="T3:U549"><span class="var type1" id="S80T3U791">triangleAvailable</span> =<span class="mxinfo " id="T3:U551">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,248" id="srcline248">248</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,249" id="srcline249">249</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T8:U552"><span class="var type1" id="S77T3U796">ninetyCounter</span>&gt;=<span class="mxinfo " id="T3:U554">4</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,250" id="srcline250">250</a></span><span class="line">    <span class="mxinfo " id="T3:U555"><span class="var type1" id="S81T3U800">squareAvailable</span>=<span class="mxinfo " id="T3:U557">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,251" id="srcline251">251</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,252" id="srcline252">252</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T8:U558"><span class="var type1" id="S76T3U805">one35Counter</span>&gt;=<span class="mxinfo " id="T3:U560">8</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,253" id="srcline253">253</a></span><span class="line">    <span class="mxinfo " id="T3:U561"><span class="var type1" id="S82T3U809">octagonAvailable</span> = <span class="mxinfo " id="T3:U563">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,254" id="srcline254">254</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,255" id="srcline255">255</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,256" id="srcline256">256</a></span><span class="line"><span class="mxinfo " id="T1:U564"><span class="var type1" id="S2T1U813">availableShapes</span> = <span class="mxinfo " id="T1:U566">[<span class="var type1" id="S80T3U816">triangleAvailable</span> <span class="var type1" id="S81T3U817">squareAvailable</span> <span class="var type1" id="S82T3U818">octagonAvailable</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,257" id="srcline257">257</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,258" id="srcline258">258</a></span><span class="line"><span class="keyword">end</span> <span class="comment">%end of main function</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,259" id="srcline259">259</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,260" id="srcline260">260</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,261" id="srcline261">261</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,262" id="srcline262">262</a></span><span class="line"><span class="comment">%CREATE SINE AND COSINE LOOKUP TABLE (IMPROVES SPEED OF COMPUTATION)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,263" id="srcline263">263</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
</pre>
